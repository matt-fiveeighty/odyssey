---
phase: 06-api-integrations
plan: 03
type: execute
wave: 3
depends_on: ["06-02"]
files_modified:
  - src/components/results/sections/PortfolioOverview.tsx
  - src/components/results/sections/HeroSummary.tsx
autonomous: true

must_haves:
  truths:
    - "PortfolioOverview inflation projections use real BLS CPI rate from /api/inflation/cpi instead of hardcoded 0.035"
    - "HeroSummary 10-year total uses real BLS CPI rate from /api/inflation/cpi instead of hardcoded 0.035"
    - "When the inflation API returns fallback data, the UI renders identically to current behavior (3.5% rate, no errors)"
    - "Inflation rate is fetched once at component mount and reused across all calculations"
  artifacts:
    - path: "src/components/results/sections/PortfolioOverview.tsx"
      provides: "Inflation toggle using real CPI rate"
      contains: "api/inflation/cpi"
    - path: "src/components/results/sections/HeroSummary.tsx"
      provides: "10-year total using real CPI rate"
      contains: "api/inflation/cpi"
  key_links:
    - from: "src/components/results/sections/PortfolioOverview.tsx"
      to: "/api/inflation/cpi"
      via: "fetch on mount to get real inflation rate"
      pattern: "fetch.*api/inflation/cpi"
    - from: "src/components/results/sections/HeroSummary.tsx"
      to: "/api/inflation/cpi"
      via: "fetch on mount to get real inflation rate"
      pattern: "fetch.*api/inflation/cpi"
---

<objective>
Wire the real BLS inflation rate into the two UI components that currently hardcode `INFLATION_RATE = 0.035`, replacing static estimates with live data from the cache-first API. Ensure seamless fallback so the UI never breaks.

Purpose: This is the final integration step that closes the loop -- real API data flows from BLS through Redis cache through the route handler into the actual UI components users see. Without this, the API infrastructure built in Plans 01-02 would be invisible to users.

Output: Both PortfolioOverview.tsx and HeroSummary.tsx fetch the real inflation rate from `/api/inflation/cpi` and use it for projections, with graceful fallback to 3.5% if the fetch fails.
</objective>

<execution_context>
@/Users/mattramirez/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mattramirez/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-api-integrations/06-02-SUMMARY.md

@src/components/results/sections/PortfolioOverview.tsx
@src/components/results/sections/HeroSummary.tsx
@src/lib/engine/verified-datum.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Wire real inflation rate into PortfolioOverview and HeroSummary</name>
  <files>src/components/results/sections/PortfolioOverview.tsx, src/components/results/sections/HeroSummary.tsx</files>
  <action>
Both components currently have `const INFLATION_RATE = 0.035;` at module level. Replace this with a dynamic fetch pattern.

**Create a shared hook or inline fetch pattern.** Since both components are "use client" and independent, use a simple `useEffect` + `useState` pattern in each (no shared hook needed -- keeps each component self-contained).

**PortfolioOverview.tsx changes:**
1. Remove `const INFLATION_RATE = 0.035;` from line 13.
2. Add state: `const [inflationRate, setInflationRate] = useState(0.035);` and `const [inflationSource, setInflationSource] = useState<"loading" | "verified" | "estimated">("loading");`.
3. Add useEffect (runs once on mount):
   ```
   useEffect(() => {
     fetch("/api/inflation/cpi")
       .then(res => res.ok ? res.json() : null)
       .then(json => {
         if (json?.data?.value != null) {
           setInflationRate(json.data.value);
           setInflationSource(json.data.confidence === "verified" ? "verified" : "estimated");
         } else {
           setInflationSource("estimated");
         }
       })
       .catch(() => setInflationSource("estimated"));
   }, []);
   ```
4. Replace all references to `INFLATION_RATE` with `inflationRate` in the component body.
5. Optionally: where the inflation rate is displayed or used in text, show a subtle indicator when the rate is "verified" vs "estimated". For example, next to the inflation toggle label, show the actual rate as a percentage: `{(inflationRate * 100).toFixed(1)}% annual`. If source is "verified", optionally add a small "(BLS)" label. Keep it subtle -- this is not a freshness badge yet (that's Phase 7).

**HeroSummary.tsx changes:**
1. Remove `const INFLATION_RATE = 0.035;` from line 10.
2. Add same state + useEffect pattern as above.
3. Replace `INFLATION_RATE` references with `inflationRate` in the `inflatedTenYearTotal` useMemo.
4. Add `inflationRate` to the useMemo dependency array (currently depends on `budgetBreakdown.tenYearProjection` and `financialSummary.tenYearTotal`).

**Critical:** The `useState(0.035)` default ensures the component renders correctly BEFORE the fetch completes. The UI is never in a "no inflation rate" state. The fetch is fire-and-forget enhancement -- if it fails, the component behaves identically to the current hardcoded behavior.

**Import changes:** Add `useEffect` to the React import in both files (PortfolioOverview already has `useState` and `useMemo`; HeroSummary has `useMemo` but needs `useState` and `useEffect` added).
  </action>
  <verify>
1. Run `npx tsc --noEmit` to confirm no type errors.
2. Verify neither file contains `const INFLATION_RATE = 0.035` (the hardcoded constant is gone).
3. Verify both files reference `inflationRate` (the dynamic state variable) instead.
4. Verify both files contain `fetch("/api/inflation/cpi")` or equivalent.
5. Verify both files have `useState(0.035)` as the default (graceful fallback).
  </verify>
  <done>
Both PortfolioOverview.tsx and HeroSummary.tsx fetch the inflation rate from /api/inflation/cpi on mount, use the real BLS rate for projections when available, and fall back to 3.5% seamlessly. The hardcoded `INFLATION_RATE = 0.035` constant is removed from both files.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with no errors
2. `grep -r "INFLATION_RATE = 0.035" src/` returns no results (hardcoded constant eliminated)
3. Both components fetch from `/api/inflation/cpi` and use the response
4. Both components default to 0.035 in useState (zero visual change when API is unavailable)
5. No new npm dependencies added
6. `npm run build` succeeds
</verification>

<success_criteria>
- Hardcoded 3.5% inflation rate is replaced by real BLS CPI data in both UI components
- Components render correctly on first paint with 0.035 default, then update if API returns a different rate
- When BLS API is unavailable (no Redis, no API key, API down), both components render identically to pre-Phase 6 behavior
- End-to-end: BLS data flows from API -> Redis cache -> /api/inflation/cpi route -> PortfolioOverview + HeroSummary
</success_criteria>

<output>
After completion, create `.planning/phases/06-api-integrations/06-03-SUMMARY.md`
</output>
